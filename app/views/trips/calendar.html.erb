<h1>Rutledge Travel Calendar Version 5</h1>

<div id="three-calendars">
  <% for month, year in next_3_months_years(@start_date) %>
    <%= calendar(:year => year, :month => month) do |day|
      if day < Date.today
        [day.mday, {:class => 'day past'}]
      else
        #puts "day = #{day.mday} class = #{class_for_day(year, month, day.mday)}"
        #debugger
        [link_to(day.mday, :action => 'new', :controller => 'trips'),  {
          :id => "day_cell#{day.mday}", :class => class_for_day(year, month, day.mday) }]
      end
    end %>
  <% end %>
  <table id="destination-list">
    <tr><th>Show Only Trips to</th></tr>
    <% @destination_list.each do |text| %>
      <tr><td> <%= text %> </td></tr>
    <% end %>
  </table>
</div>
<table id="trip-list">
  <tr>
    <% ['Date', 'Time', 'Destination', 'Contact', 'Community', 'Preferred Vehicle',
      'Travelers', 'Notes', 'Actions'].each do |header| %>
      <th> <%= header %> </th>
    <% end %>
  </tr>
  <% @trips_by_date.keys.sort.each do |date| %>
    <% days_trips = @trips_by_date[date] %>
    <% days_trips.each_with_index do |trip, i| %>
      <tr>
        <% if i == 0  #date cell should span all rows with same date %>
          <td rowspan="<%= days_trips.length %>">
            <%= days_trips[0].date.strftime("%b %d %a")%>
          </td>
        <% end %>
        <td> 
          <%= trip.depart.strftime("%I:%M%p")%>
          <br />
          <%= trip.return.strftime("%I:%M%p")%> 
        </td>
        <% letter = class_letter_for_destination(trip.destination) %>
        <td class=<%= "\"#{letter}\"" %>>
          <%= trip.destination %>
        </td>
        <% for attrib in [  'contact', 'community', 'preferred_vehicle',
            'travelers', 'notes'] %>
          <td> <%= trip.send(attrib) %> </td>
        <% end %>
      <% end %>
    </tr>
  <% end %>
</table>
