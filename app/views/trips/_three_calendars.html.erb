<% for month, year in next_3_months_years(@start_date) %>
  <%= calendar(:year => year, :month => month) do |day|
    if day < Date.today
      [day.mday, {:class => 'day past'}]
    else
      date = day.strftime("%Y%m%d")
      style_class = class_for_trips(@trips_by_date[date])
      [link_to(day.mday, :action => 'new', :controller => 'trips', :date =>date ),  {
          :id => "day_cell#{day.mday}", :class => 'day ' + style_class }]
    end
  end %>
<% end %>